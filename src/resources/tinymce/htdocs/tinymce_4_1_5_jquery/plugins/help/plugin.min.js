tinymce.PluginManager.add("help",function(e){function t(e,t,n){function r(e,n){n=n||[];tinymce.each(e,function(e){var i={text:e.text||e.title};if(e.menu){i.menu=r(e.menu)}else{i.value=e.value;t(i)}n.push(i)});return n}return r(e,n||[])}function n(t){return function(){var n=e.settings.help_list;if(typeof n=="string"){tinymce.util.XHR.send({url:n,success:function(e){t(tinymce.util.JSON.parse(e))}})}else if(typeof n=="function"){n(t)}else{t(n)}}}function r(n){function c(){var e,t,n,i;e=r.find("#width")[0];t=r.find("#height")[0];if(!e||!t){return}n=e.value();i=t.value();if(r.find("#constrain")[0].checked()&&u&&a&&n&&i){if(u!=n){i=Math.round(n/u*i);t.value(i)}else{n=Math.round(i/a*n);e.value(n)}}u=n;a=i}function h(){function t(t){function n(){t.onload=t.onerror=null;if(e.selection){e.selection.select(t);e.nodeChanged()}}t.onerror=n}v();c();i=tinymce.extend(i,r.toJSON());if(!i.alt){i.alt=""}if(i.width===""){i.width=null}if(i.height===""){i.height=null}if(!i.style){i.style=null}i={src:i.src,alt:i.alt,width:i.width,height:i.height,style:i.style,"class":i["class"]};e.undoManager.transact(function(){if(!i.src){if(o){s.remove(o);e.focus();e.nodeChanged()}return}if(!o){i.id="__mcenew";e.focus();e.selection.setContent(s.createHTML("img",i));o=s.get("__mcenew");s.setAttrib(o,"id",null)}else{s.setAttribs(o,i)}t(o)})}function p(e){if(e){e=e.replace(/px$/,"")}return e}function d(t){var n=t.meta||{};if(f){f.value(e.convertURL(this.value(),"src"))}tinymce.each(n,function(e,t){r.find("#"+t).value(e)})}function v(){function t(e){if(e.length>0&&/^[0-9]+$/.test(e)){e+="px"}return e}if(!e.settings.help_advtab){return}var n=r.toJSON();var i=s.parseStyle(n.style);delete i.margin;i["margin-top"]=i["margin-bottom"]=t(n.vspace);i["margin-left"]=i["margin-right"]=t(n.hspace);i["border-width"]=t(n.border);r.find("#style").value(s.serializeStyle(s.parseStyle(s.serializeStyle(i))))}var r,i={},s=e.dom,o=e.selection.getNode();var u,a,f,l;u=s.getAttrib(o,"width");a=s.getAttrib(o,"height");if(o.nodeName=="IMG"&&!o.getAttribute("data-mce-object")&&!o.getAttribute("data-mce-placeholder")){i={src:s.getAttrib(o,"src"),alt:s.getAttrib(o,"alt"),"class":s.getAttrib(o,"class"),width:u,height:a}}else{o=null}if(n){f={type:"listbox",label:"Image list",values:t(n,function(t){t.value=e.convertURL(t.value||t.url,"src")},[{text:"None",value:""}]),value:i.src&&e.convertURL(i.src,"src"),onselect:function(e){var t=r.find("#alt");if(!t.value()||e.lastControl&&t.value()==e.lastControl.text()){t.value(e.control.text())}r.find("#src").value(e.control.value()).fire("change")},onPostRender:function(){f=this}}}if(e.settings.help_class_list){l={name:"class",type:"listbox",label:"Class",values:t(e.settings.help_class_list,function(t){if(t.value){t.textStyle=function(){return e.formatter.getCssText({inline:"img",classes:[t.value]})}}})}}r=e.windowManager.alert("TinyMCE Version 4.1.5")}e.addButton("help",{icon:"help",tooltip:"Help",onclick:n(r),stateSelector:"img:not([data-mce-object],[data-mce-placeholder])"})})
